/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var Si=(e,t,i,r)=>{for(var s=t,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=n(s)||s);return s};var Ai=(e,t)=>(i,r)=>t(i,r,e);var Ri=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?Lt.isErrorNoTelemetry(e)?new Lt(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}};var Ti=new Ri;function Je(e){Bi(e)||Ti.onUnexpectedError(e)}var ct="Canceled";function Bi(e){return e instanceof Ei?true:e instanceof Error&&e.name===ct&&e.message===ct}var Ei=class extends Error{constructor(){super(ct),this.name=this.message}};var Lt=class dt extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof dt)return t;let i=new dt;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};var ki;(e=>{function t(o){return o<0}e.isLessThan=t;function i(o){return o<=0}e.isLessThanOrEqual=i;function r(o){return o>0}e.isGreaterThan=r;function s(o){return o===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(ki||={});function Fi(e,t){let i=this,r=false,s;return function(){if(r)return s;if(r=true,t);else s=e.apply(i,arguments);return s}}var Qt;(e=>{function t(L){return L&&typeof L=="object"&&typeof L[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(L){yield L}e.single=s;function o(L){return t(L)?L:s(L)}e.wrap=o;function n(L){return L||i}e.from=n;function*a(L){for(let A=L.length-1;A>=0;A--)yield L[A]}e.reverse=a;function c(L){return!L||L[Symbol.iterator]().next().done===true}e.isEmpty=c;function h(L){return L[Symbol.iterator]().next().value}e.first=h;function l(L,A){let R=0;for(let O of L)if(A(O,R++))return true;return false}e.some=l;function d(L,A){for(let R of L)if(A(R))return R}e.find=d;function*u(L,A){for(let R of L)A(R)&&(yield R)}e.filter=u;function*m(L,A){let R=0;for(let O of L)yield A(O,R++)}e.map=m;function*b(L,A){let R=0;for(let O of L)yield*A(O,R++)}e.flatMap=b;function*S(...L){for(let A of L)yield*A}e.concat=S;function y(L,A,R){let O=R;for(let le of L)O=A(O,le);return O}e.reduce=y;function*F(L,A,R=L.length){for(A<0&&(A+=L.length),R<0?R+=L.length:R>L.length&&(R=L.length);A<R;A++)yield L[A]}e.slice=F;function I(L,A=Number.POSITIVE_INFINITY){let R=[];if(A===0)return[R,L];let O=L[Symbol.iterator]();for(let le=0;le<A;le++){let ce=O.next();if(ce.done)return[R,e.empty()];R.push(ce.value)}return[R,{[Symbol.iterator](){return O}}]}e.consume=I;async function z(L){let A=[];for await(let R of L)A.push(R);return Promise.resolve(A)}e.asyncToArray=z})(Qt||={});function $i(e){return e}function Zt(e,t){}function Kt(e){if(Qt.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function Jt(...e){let t=j(()=>Kt(e));return t}function j(e){let t=$i({dispose:Fi(()=>{e()})});return t}var ei=class ti{constructor(){this._toDispose=new Set;this._isDisposed=false}dispose(){this._isDisposed||(this._isDisposed=true,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Kt(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?ti.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),Zt())}};ei.DISABLE_DISPOSED_WARNING=false;var Ee=ei;var ne=class{constructor(){this._store=new Ee;Zt(this._store)}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};ne.None=Object.freeze({dispose(){}});var Fe=class{constructor(){this._isDisposed=false}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=true,this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e}};var ft=typeof process<"u"&&"title"in process;var Qe=ft?"node":navigator.userAgent;var Di=ft?"node":navigator.platform;var Pi=Qe.includes("Firefox");var Ii=Qe.includes("Edge");var ii=/^((?!chrome|android).)*safari/i.test(Qe);function Wi(){if(!ii)return 0;let e=Qe.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}Di.indexOf("Linux")>=0;var Oi="";var q=0;var G=0;var H=0;var P=0;var te={css:"#00000000",rgba:0};var X;(e=>{function t(s,o,n,a){return a!==void 0?`#${xe(s)}${xe(o)}${xe(n)}${xe(a)}`:`#${xe(s)}${xe(o)}${xe(n)}`}e.toCss=t;function i(s,o,n,a=255){return(s<<24|o<<16|n<<8|a)>>>0}e.toRgba=i;function r(s,o,n,a){return{css:e.toCss(s,o,n,a),rgba:e.toRgba(s,o,n,a)}}e.toColor=r})(X||={});var He;(e=>{function t(c,h){if(P=(h.rgba&255)/255,P===1)return{css:h.css,rgba:h.rgba};let l=h.rgba>>24&255,d=h.rgba>>16&255,u=h.rgba>>8&255,m=c.rgba>>24&255,b=c.rgba>>16&255,S=c.rgba>>8&255;q=m+Math.round((l-m)*P),G=b+Math.round((d-b)*P),H=S+Math.round((u-S)*P);let y=X.toCss(q,G,H),F=X.toRgba(q,G,H);return{css:y,rgba:F}}e.blend=t;function i(c){return(c.rgba&255)===255}e.isOpaque=i;function r(c,h,l){let d=be.ensureContrastRatio(c.rgba,h.rgba,l);if(d)return X.toColor(d>>24&255,d>>16&255,d>>8&255)}e.ensureContrastRatio=r;function s(c){let h=(c.rgba|255)>>>0;return[q,G,H]=be.toChannels(h),{css:X.toCss(q,G,H),rgba:h}}e.opaque=s;function o(c,h){return P=Math.round(h*255),[q,G,H]=be.toChannels(c.rgba),{css:X.toCss(q,G,H,P),rgba:X.toRgba(q,G,H,P)}}e.opacity=o;function n(c,h){return P=c.rgba&255,o(c,P*h/255)}e.multiplyOpacity=n;function a(c){return[c.rgba>>24&255,c.rgba>>16&255,c.rgba>>8&255]}e.toColorRGB=a})(He||={});var zi;(e=>{let t,i;try{let s=document.createElement("canvas");s.width=1,s.height=1;let o=s.getContext("2d",{willReadFrequently:true});o&&(t=o,t.globalCompositeOperation="copy",i=t.createLinearGradient(0,0,1,1))}catch{}function r(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return q=parseInt(s.slice(1,2).repeat(2),16),G=parseInt(s.slice(2,3).repeat(2),16),H=parseInt(s.slice(3,4).repeat(2),16),X.toColor(q,G,H);case 5:return q=parseInt(s.slice(1,2).repeat(2),16),G=parseInt(s.slice(2,3).repeat(2),16),H=parseInt(s.slice(3,4).repeat(2),16),P=parseInt(s.slice(4,5).repeat(2),16),X.toColor(q,G,H,P);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let o=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(o)return q=parseInt(o[1]),G=parseInt(o[2]),H=parseInt(o[3]),P=Math.round((o[5]===void 0?1:parseFloat(o[5]))*255),X.toColor(q,G,H,P);if(!t||!i)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=i,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[q,G,H,P]=t.getImageData(0,0,1,1).data,P!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:X.toRgba(q,G,H,P),css:s}}e.toColor=r})(zi||={});var Y;(e=>{function t(r){return i(r>>16&255,r>>8&255,r&255)}e.relativeLuminance=t;function i(r,s,o){let n=r/255,a=s/255,c=o/255,h=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),l=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),d=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4);return h*.2126+l*.7152+d*.0722}e.relativeLuminance2=i})(Y||={});var be;(e=>{function t(n,a){if(P=(a&255)/255,P===1)return a;let c=a>>24&255,h=a>>16&255,l=a>>8&255,d=n>>24&255,u=n>>16&255,m=n>>8&255;return q=d+Math.round((c-d)*P),G=u+Math.round((h-u)*P),H=m+Math.round((l-m)*P),X.toRgba(q,G,H)}e.blend=t;function i(n,a,c){let h=Y.relativeLuminance(n>>8),l=Y.relativeLuminance(a>>8);if(de(h,l)<c){if(l<h){let m=r(n,a,c),b=de(h,Y.relativeLuminance(m>>8));if(b<c){let S=s(n,a,c),y=de(h,Y.relativeLuminance(S>>8));return b>y?m:S}return m}let d=s(n,a,c),u=de(h,Y.relativeLuminance(d>>8));if(u<c){let m=r(n,a,c),b=de(h,Y.relativeLuminance(m>>8));return u>b?d:m}return d}}e.ensureContrastRatio=i;function r(n,a,c){let h=n>>24&255,l=n>>16&255,d=n>>8&255,u=a>>24&255,m=a>>16&255,b=a>>8&255,S=de(Y.relativeLuminance2(u,m,b),Y.relativeLuminance2(h,l,d));for(;S<c&&(u>0||m>0||b>0);)u-=Math.max(0,Math.ceil(u*.1)),m-=Math.max(0,Math.ceil(m*.1)),b-=Math.max(0,Math.ceil(b*.1)),S=de(Y.relativeLuminance2(u,m,b),Y.relativeLuminance2(h,l,d));return(u<<24|m<<16|b<<8|255)>>>0}e.reduceLuminance=r;function s(n,a,c){let h=n>>24&255,l=n>>16&255,d=n>>8&255,u=a>>24&255,m=a>>16&255,b=a>>8&255,S=de(Y.relativeLuminance2(u,m,b),Y.relativeLuminance2(h,l,d));for(;S<c&&(u<255||m<255||b<255);)u=Math.min(255,u+Math.ceil((255-u)*.1)),m=Math.min(255,m+Math.ceil((255-m)*.1)),b=Math.min(255,b+Math.ceil((255-b)*.1)),S=de(Y.relativeLuminance2(u,m,b),Y.relativeLuminance2(h,l,d));return(u<<24|m<<16|b<<8|255)>>>0}e.increaseLuminance=s;function o(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]}e.toChannels=o})(be||={});function xe(e){let t=e.toString(16);return t.length<2?"0"+t:t}function de(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}function W(e){if(!e)throw new Error("value must not be falsy");return e}function pt(e){return 57508<=e&&e<=57558}function Ui(e){return 57520<=e&&e<=57527}function Ni(e){return 57344<=e&&e<=63743}function qi(e){return 9472<=e&&e<=9631}function Gi(e){return e>=128512&&e<=128591||e>=127744&&e<=128511||e>=128640&&e<=128767||e>=9728&&e<=9983||e>=9984&&e<=10175||e>=65024&&e<=65039||e>=129280&&e<=129535||e>=127462&&e<=127487}function Hi(e,t,i,r){return t===1&&i>Math.ceil(r*1.5)&&e!==void 0&&e>255&&!Gi(e)&&!pt(e)&&!Ni(e)}function si(e){return pt(e)||qi(e)}function Vi(){return{css:{canvas:Ue(),cell:Ue()},device:{canvas:Ue(),cell:Ue(),char:{width:0,height:0,left:0,top:0}}}}function Ue(){return{width:0,height:0}}function ji(e,t,i=0){return(e-(Math.round(t)*2-i))%(Math.round(t)*2)}var V=0;var N=0;var oe=false;var ue=false;var Ne=false;var Q;var et=0;var Yi=class{constructor(e,t,i,r,s,o){this._terminal=e;this._optionService=t;this._selectionRenderModel=i;this._decorationService=r;this._coreBrowserService=s;this._themeService=o;this.result={fg:0,bg:0,ext:0}}resolve(e,t,i,r){if(this.result.bg=e.bg,this.result.fg=e.fg,this.result.ext=e.bg&268435456?e.extended.ext:0,N=0,V=0,ue=false,oe=false,Ne=false,Q=this._themeService.colors,et=0,e.getCode()!==0&&e.extended.underlineStyle===4){let s=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));et=t*r%(Math.round(s)*2)}if(this._decorationService.forEachDecorationAtCell(t,i,"bottom",s=>{s.backgroundColorRGB&&(N=s.backgroundColorRGB.rgba>>8&16777215,ue=true),s.foregroundColorRGB&&(V=s.foregroundColorRGB.rgba>>8&16777215,oe=true)}),Ne=this._selectionRenderModel.isCellSelected(this._terminal,t,i),Ne){if(this.result.fg&67108864||(this.result.bg&50331648)!==0){if(this.result.fg&67108864)switch(this.result.fg&50331648){case 16777216:case 33554432:N=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:N=(this.result.fg&16777215)<<8|255;break;case 0:default:N=this._themeService.colors.foreground.rgba}else switch(this.result.bg&50331648){case 16777216:case 33554432:N=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:N=(this.result.bg&16777215)<<8|255;break}N=be.blend(N,(this._coreBrowserService.isFocused?Q.selectionBackgroundOpaque:Q.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}else N=(this._coreBrowserService.isFocused?Q.selectionBackgroundOpaque:Q.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(ue=true,Q.selectionForeground&&(V=Q.selectionForeground.rgba>>8&16777215,oe=true),si(e.getCode())){if(this.result.fg&67108864&&(this.result.bg&50331648)===0)V=(this._coreBrowserService.isFocused?Q.selectionBackgroundOpaque:Q.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(this.result.fg&67108864)switch(this.result.bg&50331648){case 16777216:case 33554432:V=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:V=(this.result.bg&16777215)<<8|255;break}else switch(this.result.fg&50331648){case 16777216:case 33554432:V=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:V=(this.result.fg&16777215)<<8|255;break;case 0:default:V=this._themeService.colors.foreground.rgba}V=be.blend(V,(this._coreBrowserService.isFocused?Q.selectionBackgroundOpaque:Q.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}oe=true}}this._decorationService.forEachDecorationAtCell(t,i,"top",s=>{s.backgroundColorRGB&&(N=s.backgroundColorRGB.rgba>>8&16777215,ue=true),s.foregroundColorRGB&&(V=s.foregroundColorRGB.rgba>>8&16777215,oe=true)}),ue&&(Ne?N=e.bg&-16777216&-134217729|N|50331648:N=e.bg&-16777216|N|50331648),oe&&(V=e.fg&-16777216&-67108865|V|50331648),this.result.fg&67108864&&(ue&&!oe&&((this.result.bg&50331648)===0?V=this.result.fg&-134217728|Q.background.rgba>>8&16777215&16777215|50331648:V=this.result.fg&-134217728|this.result.bg&67108863,oe=true),!ue&&oe&&((this.result.fg&50331648)===0?N=this.result.bg&-67108864|Q.foreground.rgba>>8&16777215&16777215|50331648:N=this.result.bg&-67108864|this.result.fg&67108863,ue=true)),Q=void 0,this.result.bg=ue?N:this.result.bg,this.result.fg=oe?V:this.result.fg,this.result.ext&=536870911,this.result.ext|=et<<29&3758096384}};var Xi=257;var Qi=.5;var ri=Pi||Ii?"bottom":"ideographic";var Zi={"â–€":[{x:0,y:0,w:8,h:4}],"â–":[{x:0,y:7,w:8,h:1}],"â–‚":[{x:0,y:6,w:8,h:2}],"â–ƒ":[{x:0,y:5,w:8,h:3}],"â–„":[{x:0,y:4,w:8,h:4}],"â–…":[{x:0,y:3,w:8,h:5}],"â–†":[{x:0,y:2,w:8,h:6}],"â–‡":[{x:0,y:1,w:8,h:7}],"â–ˆ":[{x:0,y:0,w:8,h:8}],"â–‰":[{x:0,y:0,w:7,h:8}],"â–Š":[{x:0,y:0,w:6,h:8}],"â–‹":[{x:0,y:0,w:5,h:8}],"â–Œ":[{x:0,y:0,w:4,h:8}],"â–":[{x:0,y:0,w:3,h:8}],"â–Ž":[{x:0,y:0,w:2,h:8}],"â–":[{x:0,y:0,w:1,h:8}],"â–":[{x:4,y:0,w:4,h:8}],"â–”":[{x:0,y:0,w:8,h:1}],"â–•":[{x:7,y:0,w:1,h:8}],"â––":[{x:0,y:4,w:4,h:4}],"â–—":[{x:4,y:4,w:4,h:4}],"â–˜":[{x:0,y:0,w:4,h:4}],"â–™":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"â–š":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"â–›":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"â–œ":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"â–":[{x:4,y:0,w:4,h:4}],"â–ž":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"â–Ÿ":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"ðŸ­°":[{x:1,y:0,w:1,h:8}],"ðŸ­±":[{x:2,y:0,w:1,h:8}],"ðŸ­²":[{x:3,y:0,w:1,h:8}],"ðŸ­³":[{x:4,y:0,w:1,h:8}],"ðŸ­´":[{x:5,y:0,w:1,h:8}],"ðŸ­µ":[{x:6,y:0,w:1,h:8}],"ðŸ­¶":[{x:0,y:1,w:8,h:1}],"ðŸ­·":[{x:0,y:2,w:8,h:1}],"ðŸ­¸":[{x:0,y:3,w:8,h:1}],"ðŸ­¹":[{x:0,y:4,w:8,h:1}],"ðŸ­º":[{x:0,y:5,w:8,h:1}],"ðŸ­»":[{x:0,y:6,w:8,h:1}],"ðŸ­¼":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"ðŸ­½":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"ðŸ­¾":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"ðŸ­¿":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"ðŸ®€":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"ðŸ®":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"ðŸ®‚":[{x:0,y:0,w:8,h:2}],"ðŸ®ƒ":[{x:0,y:0,w:8,h:3}],"ðŸ®„":[{x:0,y:0,w:8,h:5}],"ðŸ®…":[{x:0,y:0,w:8,h:6}],"ðŸ®†":[{x:0,y:0,w:8,h:7}],"ðŸ®‡":[{x:6,y:0,w:2,h:8}],"ðŸ®ˆ":[{x:5,y:0,w:3,h:8}],"ðŸ®‰":[{x:3,y:0,w:5,h:8}],"ðŸ®Š":[{x:2,y:0,w:6,h:8}],"ðŸ®‹":[{x:1,y:0,w:7,h:8}],"ðŸ®•":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"ðŸ®–":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"ðŸ®—":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};var Ki={"â–‘":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"â–’":[[1,0],[0,0],[0,1],[0,0]],"â–“":[[0,1],[1,1],[1,0],[1,1]]};var Ji={"â”€":{1:"M0,.5 L1,.5"},"â”":{3:"M0,.5 L1,.5"},"â”‚":{1:"M.5,0 L.5,1"},"â”ƒ":{3:"M.5,0 L.5,1"},"â”Œ":{1:"M0.5,1 L.5,.5 L1,.5"},"â”":{3:"M0.5,1 L.5,.5 L1,.5"},"â”":{1:"M0,.5 L.5,.5 L.5,1"},"â”“":{3:"M0,.5 L.5,.5 L.5,1"},"â””":{1:"M.5,0 L.5,.5 L1,.5"},"â”—":{3:"M.5,0 L.5,.5 L1,.5"},"â”˜":{1:"M.5,0 L.5,.5 L0,.5"},"â”›":{3:"M.5,0 L.5,.5 L0,.5"},"â”œ":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"â”£":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"â”¤":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"â”«":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"â”¬":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"â”³":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"â”´":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"â”»":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"â”¼":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"â•‹":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"â•´":{1:"M.5,.5 L0,.5"},"â•¸":{3:"M.5,.5 L0,.5"},"â•µ":{1:"M.5,.5 L.5,0"},"â•¹":{3:"M.5,.5 L.5,0"},"â•¶":{1:"M.5,.5 L1,.5"},"â•º":{3:"M.5,.5 L1,.5"},"â•·":{1:"M.5,.5 L.5,1"},"â•»":{3:"M.5,.5 L.5,1"},"â•":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"â•‘":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"â•’":{1:(e,t)=>`M.5,1 L.5,${.5-t} L1,${.5-t} M.5,${.5+t} L1,${.5+t}`},"â•“":{1:(e,t)=>`M${.5-e},1 L${.5-e},.5 L1,.5 M${.5+e},.5 L${.5+e},1`},"â•”":{1:(e,t)=>`M1,${.5-t} L${.5-e},${.5-t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1`},"â••":{1:(e,t)=>`M0,${.5-t} L.5,${.5-t} L.5,1 M0,${.5+t} L.5,${.5+t}`},"â•–":{1:(e,t)=>`M${.5+e},1 L${.5+e},.5 L0,.5 M${.5-e},.5 L${.5-e},1`},"â•—":{1:(e,t)=>`M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M0,${.5-t} L${.5+e},${.5-t} L${.5+e},1`},"â•˜":{1:(e,t)=>`M.5,0 L.5,${.5+t} L1,${.5+t} M.5,${.5-t} L1,${.5-t}`},"â•™":{1:(e,t)=>`M1,.5 L${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"â•š":{1:(e,t)=>`M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0 M1,${.5+t} L${.5-e},${.5+t} L${.5-e},0`},"â•›":{1:(e,t)=>`M0,${.5+t} L.5,${.5+t} L.5,0 M0,${.5-t} L.5,${.5-t}`},"â•œ":{1:(e,t)=>`M0,.5 L${.5+e},.5 L${.5+e},0 M${.5-e},.5 L${.5-e},0`},"â•":{1:(e,t)=>`M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M0,${.5+t} L${.5+e},${.5+t} L${.5+e},0`},"â•ž":{1:(e,t)=>`M.5,0 L.5,1 M.5,${.5-t} L1,${.5-t} M.5,${.5+t} L1,${.5+t}`},"â•Ÿ":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1 M${.5+e},.5 L1,.5`},"â• ":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"â•¡":{1:(e,t)=>`M.5,0 L.5,1 M0,${.5-t} L.5,${.5-t} M0,${.5+t} L.5,${.5+t}`},"â•¢":{1:(e,t)=>`M0,.5 L${.5-e},.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"â•£":{1:(e,t)=>`M${.5+e},0 L${.5+e},1 M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0`},"â•¤":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t} M.5,${.5+t} L.5,1`},"â•¥":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},1 M${.5+e},.5 L${.5+e},1`},"â•¦":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1`},"â•§":{1:(e,t)=>`M.5,0 L.5,${.5-t} M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"â•¨":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"â•©":{1:(e,t)=>`M0,${.5+t} L1,${.5+t} M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"â•ª":{1:(e,t)=>`M.5,0 L.5,1 M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"â•«":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"â•¬":{1:(e,t)=>`M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1 M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"â•±":{1:"M1,0 L0,1"},"â•²":{1:"M0,0 L1,1"},"â•³":{1:"M1,0 L0,1 M0,0 L1,1"},"â•¼":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"â•½":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"â•¾":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"â•¿":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"â”":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"â”Ž":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"â”‘":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"â”’":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"â”•":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"â”–":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"â”™":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"â”š":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"â”":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"â”ž":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"â”Ÿ":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"â” ":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"â”¡":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"â”¢":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"â”¥":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"â”¦":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"â”§":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"â”¨":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"â”©":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"â”ª":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"â”­":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"â”®":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"â”¯":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"â”°":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"â”±":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"â”²":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"â”µ":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"â”¶":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"â”·":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"â”¸":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"â”¹":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"â”º":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"â”½":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"â”¾":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"â”¿":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"â•€":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"â•":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"â•‚":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"â•ƒ":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"â•„":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"â•…":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"â•†":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"â•‡":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"â•ˆ":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"â•‰":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"â•Š":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"â•Œ":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"â•":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"â”„":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"â”…":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"â”ˆ":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"â”‰":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"â•Ž":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"â•":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"â”†":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"â”‡":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"â”Š":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"â”‹":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"â•­":{1:(e,t)=>`M.5,1 L.5,${.5+t/.15*.5} C.5,${.5+t/.15*.5},.5,.5,1,.5`},"â•®":{1:(e,t)=>`M.5,1 L.5,${.5+t/.15*.5} C.5,${.5+t/.15*.5},.5,.5,0,.5`},"â•¯":{1:(e,t)=>`M.5,0 L.5,${.5-t/.15*.5} C.5,${.5-t/.15*.5},.5,.5,0,.5`},"â•°":{1:(e,t)=>`M.5,0 L.5,${.5-t/.15*.5} C.5,${.5-t/.15*.5},.5,.5,1,.5`}};var Ie={"î‚ ":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"î‚¡":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"î‚¢":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"î‚°":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"î‚±":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"î‚²":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"î‚³":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"î‚´":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"î‚µ":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"î‚¶":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"î‚·":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"î‚¸":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"î‚¹":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"î‚º":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"î‚¼":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"î‚½":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"î‚¾":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};Ie["î‚»"]=Ie["î‚½"];Ie["î‚¿"]=Ie["î‚¹"];function es(e,t,i,r,s,o,n,a){let c=Zi[t];if(c)return ts(e,c,i,r,s,o),true;let h=Ki[t];if(h)return is(e,h,i,r,s,o),true;let l=Ji[t];if(l)return ss(e,l,i,r,s,o,a),true;let d=Ie[t];return d?(rs(e,d,i,r,s,o,n,a),true):false}function ts(e,t,i,r,s,o){for(let n=0;n<t.length;n++){let a=t[n],c=s/8,h=o/8;e.fillRect(i+a.x*c,r+a.y*h,a.w*c,a.h*h)}}var bt=new Map;function is(e,t,i,r,s,o){let n=bt.get(t);n||(n=new Map,bt.set(t,n));let a=e.fillStyle;if(typeof a!="string")throw new Error(`Unexpected fillStyle type "${a}"`);let c=n.get(a);if(!c){let h=t[0].length,l=t.length,d=e.canvas.ownerDocument.createElement("canvas");d.width=h,d.height=l;let u=W(d.getContext("2d")),m=new ImageData(h,l),b,S,y,F;if(a.startsWith("#"))b=parseInt(a.slice(1,3),16),S=parseInt(a.slice(3,5),16),y=parseInt(a.slice(5,7),16),F=a.length>7&&parseInt(a.slice(7,9),16)||1;else if(a.startsWith("rgba"))[b,S,y,F]=a.substring(5,a.length-1).split(",").map(I=>parseFloat(I));else throw new Error(`Unexpected fillStyle color format "${a}" when drawing pattern glyph`);for(let I=0;I<l;I++)for(let z=0;z<h;z++)m.data[(I*h+z)*4]=b,m.data[(I*h+z)*4+1]=S,m.data[(I*h+z)*4+2]=y,m.data[(I*h+z)*4+3]=t[I][z]*(F*255);u.putImageData(m,0,0),c=W(e.createPattern(d,null)),n.set(a,c)}e.fillStyle=c,e.fillRect(i,r,s,o)}function ss(e,t,i,r,s,o,n){e.strokeStyle=e.fillStyle;for(let[a,c]of Object.entries(t)){e.beginPath(),e.lineWidth=n*Number.parseInt(a);let h;if(typeof c=="function"){let l=.15/o*s;h=c(.15,l)}else h=c;for(let l of h.split(" ")){let d=l[0],u=ni[d];if(!u){console.error(`Could not find drawing instructions for "${d}"`);continue}let m=l.substring(1).split(",");!m[0]||!m[1]||u(e,oi(m,s,o,i,r,true,n))}e.stroke(),e.closePath()}}function rs(e,t,i,r,s,o,n,a){let c=new Path2D;c.rect(i,r,s,o),e.clip(c),e.beginPath();let h=n/12;e.lineWidth=a*h;for(let l of t.d.split(" ")){let d=l[0],u=ni[d];if(!u){console.error(`Could not find drawing instructions for "${d}"`);continue}let m=l.substring(1).split(",");!m[0]||!m[1]||u(e,oi(m,s,o,i,r,false,a,(t.leftPadding??0)*(h/2),(t.rightPadding??0)*(h/2)))}t.type===1?(e.strokeStyle=e.fillStyle,e.stroke()):e.fill(),e.closePath()}function yt(e,t,i=0){return Math.max(Math.min(e,t),i)}var ni={C:(e,t)=>e.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5]),L:(e,t)=>e.lineTo(t[0],t[1]),M:(e,t)=>e.moveTo(t[0],t[1])};function oi(e,t,i,r,s,o,n,a=0,c=0){let h=e.map(l=>parseFloat(l)||parseInt(l));if(h.length<2)throw new Error("Too few arguments for instruction");for(let l=0;l<h.length;l+=2)h[l]*=t-a*n-c*n,o&&h[l]!==0&&(h[l]=yt(Math.round(h[l]+.5)-.5,t,0)),h[l]+=r+a*n;for(let l=1;l<h.length;l+=2)h[l]*=i,o&&h[l]!==0&&(h[l]=yt(Math.round(h[l]+.5)-.5,i,0)),h[l]+=s;return h}var Mt=class{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}};var St=class{constructor(){this._data=new Mt}set(e,t,i,r,s){this._data.get(e,t)||this._data.set(e,t,new Mt),this._data.get(e,t).set(i,r,s)}get(e,t,i,r){return this._data.get(e,t)?.get(i,r)}clear(){this._data.clear()}};var ai=class{constructor(){this._tasks=[];this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),i=Math.max(t,i),s=e.timeRemaining(),i*1.5>s){r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),this._start();return}r=s}this.clear()}};var ns=class extends ai{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}};var os=class extends ai{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}};var as=!ft&&"requestIdleCallback"in window?os:ns;var Te=class hi{constructor(){this.fg=0;this.bg=0;this.extended=new li}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new hi;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}};var li=class ci{constructor(t=0,i=0){this._ext=0;this._urlId=0;this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new ci(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}};var hs=globalThis.performance&&typeof globalThis.performance.now=="function";var ls=class di{static create(t){return new di(t)}constructor(t){this._now=hs&&t===false?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}};var fe;(e=>{e.None=()=>ne.None;function t(w,_){return d(w,()=>{},0,void 0,true,void 0,_)}e.defer=t;function i(w){return(_,C=null,f)=>{let g=false,v;return v=w(x=>{if(!g)return v?v.dispose():g=true,_.call(C,x)},null,f),g&&v.dispose(),v}}e.once=i;function r(w,_,C){return h((f,g=null,v)=>w(x=>f.call(g,_(x)),null,v),C)}e.map=r;function s(w,_,C){return h((f,g=null,v)=>w(x=>{_(x),f.call(g,x)},null,v),C)}e.forEach=s;function o(w,_,C){return h((f,g=null,v)=>w(x=>_(x)&&f.call(g,x),null,v),C)}e.filter=o;function n(w){return w}e.signal=n;function a(...w){return(_,C=null,f)=>{let g=Jt(...w.map(v=>v(x=>_.call(C,x))));return l(g,f)}}e.any=a;function c(w,_,C,f){let g=C;return r(w,v=>(g=_(g,v),g),f)}e.reduce=c;function h(w,_){let C,f={onWillAddFirstListener(){C=w(g.fire,g)},onDidRemoveLastListener(){C?.dispose()}};let g=new E(f);return _?.add(g),g.event}function l(w,_){return _ instanceof Array?_.push(w):_&&_.add(w),w}function d(w,_,C=100,f=false,g=false,v,x){let p,M,U,k=0,re,Ce={leakWarningThreshold:v,onWillAddFirstListener(){p=w(Z=>{k++,M=_(M,Z),f&&!U&&(ee.fire(M),M=void 0),re=()=>{let $=M;M=void 0,U=void 0,(!f||k>1)&&ee.fire($),k=0},typeof C=="number"?(clearTimeout(U),U=setTimeout(re,C)):U===void 0&&(U=0,queueMicrotask(re))})},onWillRemoveListener(){g&&k>0&&re?.()},onDidRemoveLastListener(){re=void 0,p.dispose()}};let ee=new E(Ce);return x?.add(ee),ee.event}e.debounce=d;function u(w,_=0,C){return e.debounce(w,(f,g)=>f?(f.push(g),f):[g],_,void 0,true,void 0,C)}e.accumulate=u;function m(w,_=(f,g)=>f===g,C){let f=true,g;return o(w,v=>{let x=f||!_(v,g);return f=false,g=v,x},C)}e.latch=m;function b(w,_,C){return[e.filter(w,_,C),e.filter(w,f=>!_(f),C)]}e.split=b;function S(w,_=false,C=[],f){let g=C.slice(),v=w(M=>{g?g.push(M):p.fire(M)});f&&f.add(v);let x=()=>{g?.forEach(M=>p.fire(M)),g=null},p=new E({onWillAddFirstListener(){v||(v=w(M=>p.fire(M)),f&&f.add(v))},onDidAddFirstListener(){g&&(_?setTimeout(x):x())},onDidRemoveLastListener(){v&&v.dispose(),v=null}});return f&&f.add(p),p.event}e.buffer=S;function y(w,_){return(C,f,g)=>{let v=_(new I);return w(function(x){let p=v.evaluate(x);p!==F&&C.call(f,p)},void 0,g)}}e.chain=y;let F=Symbol("HaltChainable");class I{constructor(){this.steps=[]}map(_){return this.steps.push(_),this}forEach(_){return this.steps.push(C=>(_(C),C)),this}filter(_){return this.steps.push(C=>_(C)?C:F),this}reduce(_,C){let f=C;return this.steps.push(g=>(f=_(f,g),f)),this}latch(_=(C,f)=>C===f){let C=true,f;return this.steps.push(g=>{let v=C||!_(g,f);return C=false,f=g,v?g:F}),this}evaluate(_){for(let C of this.steps)if(_=C(_),_===F)break;return _}}function z(w,_,C=f=>f){let f=(...p)=>x.fire(C(...p)),g=()=>w.on(_,f),v=()=>w.removeListener(_,f),x=new E({onWillAddFirstListener:g,onDidRemoveLastListener:v});return x.event}e.fromNodeEventEmitter=z;function L(w,_,C=f=>f){let f=(...p)=>x.fire(C(...p)),g=()=>w.addEventListener(_,f),v=()=>w.removeEventListener(_,f),x=new E({onWillAddFirstListener:g,onDidRemoveLastListener:v});return x.event}e.fromDOMEventEmitter=L;function A(w){return new Promise(_=>i(w)(_))}e.toPromise=A;function R(w){let _=new E;return w.then(C=>{_.fire(C)},()=>{_.fire(void 0)}).finally(()=>{_.dispose()}),_.event}e.fromPromise=R;function O(w,_){return w(C=>_.fire(C))}e.forward=O;function le(w,_,C){return _(C),w(f=>_(f))}e.runAndSubscribe=le;class ce{constructor(_,C){this._observable=_;this._counter=0;this._hasChanged=false;let f={onWillAddFirstListener:()=>{_.addObserver(this)},onDidRemoveLastListener:()=>{_.removeObserver(this)}};this.emitter=new E(f),C&&C.add(this.emitter)}beginUpdate(_){this._counter++}handlePossibleChange(_){}handleChange(_,C){this._hasChanged=true}endUpdate(_){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=false,this.emitter.fire(this._observable.get())))}}function T(w,_){return new ce(w,_).emitter.event}e.fromObservable=T;function Me(w){return(_,C,f)=>{let g=0,v=false,x={beginUpdate(){g++},endUpdate(){g--,g===0&&(w.reportChanges(),v&&(v=false,_.call(C)))},handlePossibleChange(){},handleChange(){v=true}};w.addObserver(x),w.reportChanges();let p={dispose(){w.removeObserver(x)}};return f instanceof Ee?f.add(p):Array.isArray(f)&&f.push(p),p}}e.fromObservableLight=Me})(fe||={});var ut=class _t{constructor(t){this.listenerCount=0;this.invocationCount=0;this.elapsedOverall=0;this.durations=[];this.name=`${t}_${_t._idPool++}`,_t.all.add(this)}start(t){this._stopWatch=new ls,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};ut.all=new Set,ut._idPool=0;var cs=ut;var ds=-1;var ui=class _i{constructor(t,i,r=(_i._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t;this.threshold=i;this.name=r;this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[o,n]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${n}):`;console.warn(a),console.warn(o);let c=new gs(a,o);this._errorHandler(c)}return()=>{let o=this._stacks.get(t.value)||0;this._stacks.set(t.value,o-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};ui._idPool=1;var us=ui;var _s=class gi{constructor(t){this.value=t}static create(){let t=new Error;return new gi(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}};var gs=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}};var vs=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}};var fs=0;var tt=class{constructor(e){this.value=e;this.id=fs++}};var ps=2;var ms;var E=class{constructor(e){this._size=0;this._options=e,this._leakageMon=this._options?.leakWarningThreshold?new us(e?.onListenerError??Je,this._options?.leakWarningThreshold??ds):void 0,this._perfMon=this._options?._profName?new cs(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=true,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let n=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(n);let a=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],c=new vs(`${n}. HINT: Stack shows most frequent listener (${a[1]}-times)`,a[0]);return(this._options?.onListenerError||Je)(c),ne.None}if(this._disposed)return ne.None;t&&(e=e.bind(t));let r=new tt(e),s;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=_s.create(),s=this._leakageMon.check(r.stack,this._size+1)),this._listeners?this._listeners instanceof tt?(this._deliveryQueue??=new ws,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=j(()=>{s?.(),this._removeListener(r)});if(i instanceof Ee?i.add(o):Array.isArray(i)&&i.push(o),ms);return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*ps<=t.length){let s=0;for(let o=0;o<t.length;o++)t[o]?t[s++]=t[o]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||Je;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof tt)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}};var ws=class{constructor(){this.i=-1;this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}};var At={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};var $e=2;var De;var me=class Re{constructor(t,i,r){this._document=t;this._config=i;this._unicodeService=r;this._didWarmUp=false;this._cacheMap=new St;this._cacheMapCombined=new St;this._pages=[];this._activePages=[];this._workBoundingBox={top:0,left:0,bottom:0,right:0};this._workAttributeData=new Te;this._textureSize=512;this._onAddTextureAtlasCanvas=new E;this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;this._onRemoveTextureAtlasCanvas=new E;this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event;this._requestClearModel=false;this._createNewPage(),this._tmpCanvas=vi(t,this._config.deviceCellWidth*4+$e*2,this._config.deviceCellHeight+$e*2),this._tmpCtx=W(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:true}))}get pages(){return this._pages}dispose(){for(let t of this.pages)t.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=true)}_doWarmUp(){let t=new as;for(let i=33;i<126;i++)t.enqueue(()=>{if(!this._cacheMap.get(i,0,0,0)){let r=this._drawToCache(i,0,0,0);this._cacheMap.set(i,0,0,0,r)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(!(this._pages[0].currentRow.x===0&&this._pages[0].currentRow.y===0)){for(let t of this._pages)t.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=false}}_createNewPage(){if(Re.maxAtlasPages&&this._pages.length>=Math.max(4,Re.maxAtlasPages)){let i=this._pages.filter(h=>h.canvas.width*2<=(Re.maxTextureSize||4096)).sort((h,l)=>l.canvas.width!==h.canvas.width?l.canvas.width-h.canvas.width:l.percentageUsed-h.percentageUsed),r=-1,s=0;for(let h=0;h<i.length;h++)if(i[h].canvas.width!==s)r=h,s=i[h].canvas.width;else if(h-r===3)break;let o=i.slice(r,r+4),n=o.map(h=>h.glyphs[0].texturePage).sort((h,l)=>h>l?1:-1),a=this.pages.length-o.length,c=this._mergePages(o,a);c.version++;for(let h=n.length-1;h>=0;h--)this._deletePage(n[h]);this.pages.push(c),this._requestClearModel=true,this._onAddTextureAtlasCanvas.fire(c.canvas)}let t=new Rt(this._document,this._textureSize);return this._pages.push(t),this._activePages.push(t),this._onAddTextureAtlasCanvas.fire(t.canvas),t}_mergePages(t,i){let r=t[0].canvas.width*2,s=new Rt(this._document,r,t);for(let[o,n]of t.entries()){let a=o*n.canvas.width%r,c=Math.floor(o/2)*n.canvas.height;s.ctx.drawImage(n.canvas,a,c);for(let l of n.glyphs)l.texturePage=i,l.sizeClipSpace.x=l.size.x/r,l.sizeClipSpace.y=l.size.y/r,l.texturePosition.x+=a,l.texturePosition.y+=c,l.texturePositionClipSpace.x=l.texturePosition.x/r,l.texturePositionClipSpace.y=l.texturePosition.y/r;this._onRemoveTextureAtlasCanvas.fire(n.canvas);let h=this._activePages.indexOf(n);h!==-1&&this._activePages.splice(h,1)}return s}_deletePage(t){this._pages.splice(t,1);for(let i=t;i<this._pages.length;i++){let r=this._pages[i];for(let s of r.glyphs)s.texturePage--;r.version++}}getRasterizedGlyphCombinedChar(t,i,r,s,o){return this._getFromCacheMap(this._cacheMapCombined,t,i,r,s,o)}getRasterizedGlyph(t,i,r,s,o){return this._getFromCacheMap(this._cacheMap,t,i,r,s,o)}_getFromCacheMap(t,i,r,s,o,n=false){return De=t.get(i,r,s,o),De||(De=this._drawToCache(i,r,s,o,n),t.set(i,r,s,o,De)),De}_getColorFromAnsiIndex(t){if(t>=this._config.colors.ansi.length)throw new Error("No color found for idx "+t);return this._config.colors.ansi[t]}_getBackgroundColor(t,i,r,s){if(this._config.allowTransparency)return te;let o;switch(t){case 16777216:case 33554432:o=this._getColorFromAnsiIndex(i);break;case 50331648:let n=Te.toColorRGB(i);o=X.toColor(n[0],n[1],n[2]);break;case 0:default:r?o=He.opaque(this._config.colors.foreground):o=this._config.colors.background;break}return o}_getForegroundColor(t,i,r,s,o,n,a,c,h,l){let d=this._getMinimumContrastColor(t,i,r,s,o,n,a,h,c,l);if(d)return d;let u;switch(o){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&h&&n<8&&(n+=8),u=this._getColorFromAnsiIndex(n);break;case 50331648:let m=Te.toColorRGB(n);u=X.toColor(m[0],m[1],m[2]);break;case 0:default:a?u=this._config.colors.background:u=this._config.colors.foreground}return this._config.allowTransparency&&(u=He.opaque(u)),c&&(u=He.multiplyOpacity(u,Qi)),u}_resolveBackgroundRgba(t,i,r){switch(t){case 16777216:case 33554432:return this._getColorFromAnsiIndex(i).rgba;case 50331648:return i<<8;case 0:default:return r?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(t,i,r,s){switch(t){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&s&&i<8&&(i+=8),this._getColorFromAnsiIndex(i).rgba;case 50331648:return i<<8;case 0:default:return r?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(t,i,r,s,o,n,a,c,h,l){if(this._config.minimumContrastRatio===1||l)return;let d=this._getContrastCache(h),u=d.getColor(t,s);if(u!==void 0)return u||void 0;let m=this._resolveBackgroundRgba(i,r,a),b=this._resolveForegroundRgba(o,n,a,c),S=be.ensureContrastRatio(m,b,this._config.minimumContrastRatio/(h?2:1));if(!S){d.setColor(t,s,null);return}let y=X.toColor(S>>24&255,S>>16&255,S>>8&255);return d.setColor(t,s,y),y}_getContrastCache(t){return t?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(t,i,r,s,o=false){let n=typeof t=="number"?String.fromCharCode(t):t,a=Math.min(this._config.deviceCellWidth*Math.max(n.length,2)+$e*2,this._textureSize);this._tmpCanvas.width<a&&(this._tmpCanvas.width=a);let c=Math.min(this._config.deviceCellHeight+$e*4,this._textureSize);if(this._tmpCanvas.height<c&&(this._tmpCanvas.height=c),this._tmpCtx.save(),this._workAttributeData.fg=r,this._workAttributeData.bg=i,this._workAttributeData.extended.ext=s,!!this._workAttributeData.isInvisible())return At;let h=!!this._workAttributeData.isBold(),l=!!this._workAttributeData.isInverse(),d=!!this._workAttributeData.isDim(),u=!!this._workAttributeData.isItalic(),m=!!this._workAttributeData.isUnderline(),b=!!this._workAttributeData.isStrikethrough(),S=!!this._workAttributeData.isOverline(),y=this._workAttributeData.getFgColor(),F=this._workAttributeData.getFgColorMode(),I=this._workAttributeData.getBgColor(),z=this._workAttributeData.getBgColorMode();if(l){let p=y;y=I,I=p;let M=F;F=z,z=M}let L=this._getBackgroundColor(z,I,l,d);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=L.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let A=h?this._config.fontWeightBold:this._config.fontWeight,R=u?"italic":"";this._tmpCtx.font=`${R} ${A} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=ri;let O=n.length===1&&pt(n.charCodeAt(0)),le=n.length===1&&Ui(n.charCodeAt(0)),ce=this._getForegroundColor(i,z,I,r,F,y,l,d,h,si(n.charCodeAt(0)));this._tmpCtx.fillStyle=ce.css;let T=le?0:$e*2,Me=false;this._config.customGlyphs!==false&&(Me=es(this._tmpCtx,n,T,T,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let w=!O,_;if(typeof t=="number"?_=this._unicodeService.wcwidth(t):_=this._unicodeService.getStringCellWidth(t),m){this._tmpCtx.save();let p=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),M=p%2===1?.5:0;if(this._tmpCtx.lineWidth=p,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())w=false,this._tmpCtx.strokeStyle=`rgb(${Te.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{w=false;let Z=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&Z<8&&(Z+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(Z).css}this._tmpCtx.beginPath();let U=T,k=Math.ceil(T+this._config.deviceCharHeight)-M-(o?p*2:0),re=k+p,Ce=k+p*2,ee=this._workAttributeData.getUnderlineVariantOffset();for(let Z=0;Z<_;Z++){this._tmpCtx.save();let $=U+Z*this._config.deviceCellWidth,K=U+(Z+1)*this._config.deviceCellWidth,Ze=$+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo($,k),this._tmpCtx.lineTo(K,k),this._tmpCtx.moveTo($,Ce),this._tmpCtx.lineTo(K,Ce);break;case 3:let We=p<=1?Ce:Math.ceil(T+this._config.deviceCharHeight-p/2)-M,Oe=p<=1?k:Math.ceil(T+this._config.deviceCharHeight+p/2)-M,wt=new Path2D;wt.rect($,k,this._config.deviceCellWidth,Ce-k),this._tmpCtx.clip(wt),this._tmpCtx.moveTo($-this._config.deviceCellWidth/2,re),this._tmpCtx.bezierCurveTo($-this._config.deviceCellWidth/2,Oe,$,Oe,$,re),this._tmpCtx.bezierCurveTo($,We,Ze,We,Ze,re),this._tmpCtx.bezierCurveTo(Ze,Oe,K,Oe,K,re),this._tmpCtx.bezierCurveTo(K,We,K+this._config.deviceCellWidth/2,We,K+this._config.deviceCellWidth/2,re);break;case 4:let ze=ee===0?0:ee>=p?p*2-ee:p-ee;!(ee>=p)===false||ze===0?(this._tmpCtx.setLineDash([Math.round(p),Math.round(p)]),this._tmpCtx.moveTo($+ze,k),this._tmpCtx.lineTo(K,k)):(this._tmpCtx.setLineDash([Math.round(p),Math.round(p)]),this._tmpCtx.moveTo($,k),this._tmpCtx.lineTo($+ze,k),this._tmpCtx.moveTo($+ze+p,k),this._tmpCtx.lineTo(K,k)),ee=ji(K-$,p,ee);break;case 5:let bi=.6,yi=.3,Ke=K-$,Ct=Math.floor(bi*Ke),xt=Math.floor(yi*Ke),Mi=Ke-Ct-xt;this._tmpCtx.setLineDash([Ct,xt,Mi]),this._tmpCtx.moveTo($,k),this._tmpCtx.lineTo(K,k);break;case 1:default:this._tmpCtx.moveTo($,k),this._tmpCtx.lineTo(K,k);break}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!Me&&this._config.fontSize>=12&&!this._config.allowTransparency&&n!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let Z=this._tmpCtx.measureText(n);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in Z&&Z.actualBoundingBoxDescent>0){this._tmpCtx.save();let $=new Path2D;$.rect(U,k-Math.ceil(p/2),this._config.deviceCellWidth*_,Ce-k+Math.ceil(p/2)),this._tmpCtx.clip($),this._tmpCtx.lineWidth=this._config.devicePixelRatio*3,this._tmpCtx.strokeStyle=L.css,this._tmpCtx.strokeText(n,T,T+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(S){let p=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),M=p%2===1?.5:0;this._tmpCtx.lineWidth=p,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(T,T+M),this._tmpCtx.lineTo(T+this._config.deviceCharWidth*_,T+M),this._tmpCtx.stroke()}if(Me||this._tmpCtx.fillText(n,T,T+this._config.deviceCharHeight),n==="_"&&!this._config.allowTransparency){let p=it(this._tmpCtx.getImageData(T,T,this._config.deviceCellWidth,this._config.deviceCellHeight),L,ce,w);if(p)for(let M=1;M<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=L.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(n,T,T+this._config.deviceCharHeight-M),p=it(this._tmpCtx.getImageData(T,T,this._config.deviceCellWidth,this._config.deviceCellHeight),L,ce,w),!!p);M++);}if(b){let p=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),M=this._tmpCtx.lineWidth%2===1?.5:0;this._tmpCtx.lineWidth=p,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(T,T+Math.floor(this._config.deviceCharHeight/2)-M),this._tmpCtx.lineTo(T+this._config.deviceCharWidth*_,T+Math.floor(this._config.deviceCharHeight/2)-M),this._tmpCtx.stroke()}this._tmpCtx.restore();let C=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),f;if(this._config.allowTransparency?f=Cs(C):f=it(C,L,ce,w),f)return At;let g=this._findGlyphBoundingBox(C,this._workBoundingBox,a,le,Me,T),v,x;for(;;){if(this._activePages.length===0){let p=this._createNewPage();v=p,x=p.currentRow,x.height=g.size.y;break}v=this._activePages[this._activePages.length-1],x=v.currentRow;for(let p of this._activePages)g.size.y<=p.currentRow.height&&(v=p,x=p.currentRow);for(let p=this._activePages.length-1;p>=0;p--)for(let M of this._activePages[p].fixedRows)M.height<=x.height&&g.size.y<=M.height&&(v=this._activePages[p],x=M);if(x.y+g.size.y>=v.canvas.height||x.height>g.size.y+2){let p=false;if(v.currentRow.y+v.currentRow.height+g.size.y>=v.canvas.height){let M;for(let U of this._activePages)if(U.currentRow.y+U.currentRow.height+g.size.y<U.canvas.height){M=U;break}if(M)v=M;else if(Re.maxAtlasPages&&this._pages.length>=Re.maxAtlasPages&&x.y+g.size.y<=v.canvas.height&&x.height>=g.size.y&&x.x+g.size.x<=v.canvas.width)p=true;else{let U=this._createNewPage();v=U,x=U.currentRow,x.height=g.size.y,p=true}}p||(v.currentRow.height>0&&v.fixedRows.push(v.currentRow),x={x:0,y:v.currentRow.y+v.currentRow.height,height:g.size.y},v.fixedRows.push(x),v.currentRow={x:0,y:x.y+x.height,height:0})}if(x.x+g.size.x<=v.canvas.width)break;x===v.currentRow?(x.x=0,x.y+=x.height,x.height=0):v.fixedRows.splice(v.fixedRows.indexOf(x),1)}return g.texturePage=this._pages.indexOf(v),g.texturePosition.x=x.x,g.texturePosition.y=x.y,g.texturePositionClipSpace.x=x.x/v.canvas.width,g.texturePositionClipSpace.y=x.y/v.canvas.height,g.sizeClipSpace.x/=v.canvas.width,g.sizeClipSpace.y/=v.canvas.height,x.height=Math.max(x.height,g.size.y),x.x+=g.size.x,v.ctx.putImageData(C,g.texturePosition.x-this._workBoundingBox.left,g.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,g.size.x,g.size.y),v.addGlyph(g),v.version++,g}_findGlyphBoundingBox(t,i,r,s,o,n){i.top=0;let a=s?this._config.deviceCellHeight:this._tmpCanvas.height,c=s?this._config.deviceCellWidth:r,h=false;for(let l=0;l<a;l++){for(let d=0;d<c;d++){let u=l*this._tmpCanvas.width*4+d*4+3;if(t.data[u]!==0){i.top=l,h=true;break}}if(h)break}i.left=0,h=false;for(let l=0;l<n+c;l++){for(let d=0;d<a;d++){let u=d*this._tmpCanvas.width*4+l*4+3;if(t.data[u]!==0){i.left=l,h=true;break}}if(h)break}i.right=c,h=false;for(let l=n+c-1;l>=n;l--){for(let d=0;d<a;d++){let u=d*this._tmpCanvas.width*4+l*4+3;if(t.data[u]!==0){i.right=l,h=true;break}}if(h)break}i.bottom=a,h=false;for(let l=a-1;l>=0;l--){for(let d=0;d<c;d++){let u=l*this._tmpCanvas.width*4+d*4+3;if(t.data[u]!==0){i.bottom=l,h=true;break}}if(h)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:i.right-i.left+1,y:i.bottom-i.top+1},sizeClipSpace:{x:i.right-i.left+1,y:i.bottom-i.top+1},offset:{x:-i.left+n+(s||o?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-i.top+n+(s||o?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}};var Rt=class{constructor(e,t,i){this._usedPixels=0;this._glyphs=[];this.version=0;this.currentRow={x:0,y:0,height:0};this.fixedRows=[];if(i)for(let r of i)this._glyphs.push(...r.glyphs),this._usedPixels+=r._usedPixels;this.canvas=vi(e,t,t),this.ctx=W(this.canvas.getContext("2d",{alpha:true}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(e){this._glyphs.push(e),this._usedPixels+=e.size.x*e.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function it(e,t,i,r){let s=t.rgba>>>24,o=t.rgba>>>16&255,n=t.rgba>>>8&255,a=i.rgba>>>24,c=i.rgba>>>16&255,h=i.rgba>>>8&255,l=Math.floor((Math.abs(s-a)+Math.abs(o-c)+Math.abs(n-h))/12),d=true;for(let u=0;u<e.data.length;u+=4)e.data[u]===s&&e.data[u+1]===o&&e.data[u+2]===n||r&&Math.abs(e.data[u]-s)+Math.abs(e.data[u+1]-o)+Math.abs(e.data[u+2]-n)<l?e.data[u+3]=0:d=false;return d}function Cs(e){for(let t=0;t<e.data.length;t+=4)if(e.data[t+3]>0)return false;return true}function vi(e,t,i){let r=e.createElement("canvas");return r.width=t,r.height=i,r}function xs(e,t,i,r,s,o,n){let a={foreground:o.foreground,background:o.background,cursor:te,cursorAccent:te,selectionForeground:te,selectionBackgroundTransparent:te,selectionBackgroundOpaque:te,selectionInactiveBackgroundTransparent:te,selectionInactiveBackgroundOpaque:te,overviewRulerBorder:te,scrollbarSliderBackground:te,scrollbarSliderHoverBackground:te,scrollbarSliderActiveBackground:te,ansi:o.ansi.slice(),contrastCache:o.contrastCache,halfContrastCache:o.halfContrastCache};return{customGlyphs:s.customGlyphs,devicePixelRatio:n,letterSpacing:s.letterSpacing,lineHeight:s.lineHeight,deviceCellWidth:e,deviceCellHeight:t,deviceCharWidth:i,deviceCharHeight:r,fontFamily:s.fontFamily,fontSize:s.fontSize,fontWeight:s.fontWeight,fontWeightBold:s.fontWeightBold,allowTransparency:s.allowTransparency,drawBoldTextInBrightColors:s.drawBoldTextInBrightColors,minimumContrastRatio:s.minimumContrastRatio,colors:a}}function Tt(e,t){for(let i=0;i<e.colors.ansi.length;i++)if(e.colors.ansi[i].rgba!==t.colors.ansi[i].rgba)return false;return e.devicePixelRatio===t.devicePixelRatio&&e.customGlyphs===t.customGlyphs&&e.lineHeight===t.lineHeight&&e.letterSpacing===t.letterSpacing&&e.fontFamily===t.fontFamily&&e.fontSize===t.fontSize&&e.fontWeight===t.fontWeight&&e.fontWeightBold===t.fontWeightBold&&e.allowTransparency===t.allowTransparency&&e.deviceCharWidth===t.deviceCharWidth&&e.deviceCharHeight===t.deviceCharHeight&&e.drawBoldTextInBrightColors===t.drawBoldTextInBrightColors&&e.minimumContrastRatio===t.minimumContrastRatio&&e.colors.foreground.rgba===t.colors.foreground.rgba&&e.colors.background.rgba===t.colors.background.rgba}function Ls(e){return(e&50331648)===16777216||(e&50331648)===33554432}var se=[];function fi(e,t,i,r,s,o,n,a){let c=xs(r,s,o,n,t,i,a);for(let d=0;d<se.length;d++){let u=se[d],m=u.ownedBy.indexOf(e);if(m>=0){if(Tt(u.config,c))return u.atlas;u.ownedBy.length===1?(u.atlas.dispose(),se.splice(d,1)):u.ownedBy.splice(m,1);break}}for(let d=0;d<se.length;d++){let u=se[d];if(Tt(u.config,c))return u.ownedBy.push(e),u.atlas}let h=e._core,l={atlas:new me(document,c,h.unicodeService),config:c,ownedBy:[e]};return se.push(l),l.atlas}function Bt(e){for(let t=0;t<se.length;t++){let i=se[t].ownedBy.indexOf(e);if(i!==-1){se[t].ownedBy.length===1?(se[t].atlas.dispose(),se.splice(t,1)):se[t].ownedBy.splice(i,1);break}}}var qe=600;var bs=class{constructor(e,t){this._renderCallback=e;this._coreBrowserService=t;this.isCursorVisible=true,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=true,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(e=qe){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let t=qe-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,t>0){this._restartInterval(t);return}}this.isCursorVisible=false,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let t=qe-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(t);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},qe)},e)}pause(){this.isCursorVisible=true,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function Et(e,t,i){let r=new t.ResizeObserver(s=>{let o=s.find(c=>c.target===e);if(!o)return;if(!("devicePixelContentBoxSize"in o)){r?.disconnect(),r=void 0;return}let n=o.devicePixelContentBoxSize[0].inlineSize,a=o.devicePixelContentBoxSize[0].blockSize;n>0&&a>0&&i(n,a)});try{r.observe(e,{box:["device-pixel-content-box"]})}catch{r.disconnect(),r=void 0}return j(()=>r?.disconnect())}function ys(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}var kt=class pi extends Te{constructor(){super(...arguments);this.content=0;this.fg=0;this.bg=0;this.extended=new li;this.combinedData=""}static fromCharData(t){let i=new pi;return i.setFromCharData(t),i}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?ys(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let i=false;if(t[1].length>2)i=true;else if(t[1].length===2){let r=t[1].charCodeAt(0);if(55296<=r&&r<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(r-55296)*1024+s-56320+65536|t[2]<<22:i=true}else i=true}else this.content=t[1].charCodeAt(0)|t[2]<<22;i&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};var mi=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function wi(e,t,i){let r=W(e.createProgram());if(e.attachShader(r,W(Ft(e,e.VERTEX_SHADER,t))),e.attachShader(r,W(Ft(e,e.FRAGMENT_SHADER,i))),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;console.error(e.getProgramInfoLog(r)),e.deleteProgram(r)}function Ft(e,t,i){let r=W(e.createShader(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;console.error(e.getShaderInfoLog(r)),e.deleteShader(r)}function Ms(e,t){let i=Math.min(e.length*2,t),r=new Float32Array(i);for(let s=0;s<e.length;s++)r[s]=e[s];return r}var Ss=class{constructor(e){this.texture=e,this.version=-1}};var As=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`;function Rs(e){let t="";for(let i=1;i<e;i++)t+=` else if (v_texpage == ${i}) { outColor = texture(u_texture[${i}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${e}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${t}
}`}var we=11;var Se=we*Float32Array.BYTES_PER_ELEMENT;var Ts=2;var D=0;var B;var st=0;var Pe=0;var Bs=class extends ne{constructor(e,t,i,r){super();this._terminal=e;this._gl=t;this._dimensions=i;this._optionsService=r;this._activeBuffer=0;this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let s=this._gl;me.maxAtlasPages===void 0&&(me.maxAtlasPages=Math.min(32,W(s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS))),me.maxTextureSize=W(s.getParameter(s.MAX_TEXTURE_SIZE))),this._program=W(wi(s,As,Rs(me.maxAtlasPages))),this._register(j(()=>s.deleteProgram(this._program))),this._projectionLocation=W(s.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=W(s.getUniformLocation(this._program,"u_resolution")),this._textureLocation=W(s.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);let o=new Float32Array([0,0,1,0,0,1,1,1]),n=s.createBuffer();this._register(j(()=>s.deleteBuffer(n))),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,o,s.STATIC_DRAW),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,this._gl.FLOAT,false,0,0);let a=new Uint8Array([0,1,2,3]),c=s.createBuffer();this._register(j(()=>s.deleteBuffer(c))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a,s.STATIC_DRAW),this._attributesBuffer=W(s.createBuffer()),this._register(j(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,2,s.FLOAT,false,Se,0),s.vertexAttribDivisor(2,1),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,s.FLOAT,false,Se,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(3,1),s.enableVertexAttribArray(4),s.vertexAttribPointer(4,1,s.FLOAT,false,Se,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(4,1),s.enableVertexAttribArray(5),s.vertexAttribPointer(5,2,s.FLOAT,false,Se,5*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(5,1),s.enableVertexAttribArray(6),s.vertexAttribPointer(6,2,s.FLOAT,false,Se,7*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(6,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,false,Se,9*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.useProgram(this._program);let h=new Int32Array(me.maxAtlasPages);for(let l=0;l<me.maxAtlasPages;l++)h[l]=l;s.uniform1iv(this._textureLocation,h),s.uniformMatrix4fv(this._projectionLocation,false,mi),this._atlasTextures=[];for(let l=0;l<me.maxAtlasPages;l++){let d=new Ss(W(s.createTexture()));this._register(j(()=>s.deleteTexture(d.texture))),s.activeTexture(s.TEXTURE0+l),s.bindTexture(s.TEXTURE_2D,d.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[l]=d}s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return this._atlas?this._atlas.beginFrame():true}updateCell(e,t,i,r,s,o,n,a,c){this._updateCell(this._vertices.attributes,e,t,i,r,s,o,n,a,c)}_updateCell(e,t,i,r,s,o,n,a,c,h){if(D=(i*this._terminal.cols+t)*we,r===0||r===void 0){e.fill(0,D,D+we-1-Ts);return}this._atlas&&(a&&a.length>1?B=this._atlas.getRasterizedGlyphCombinedChar(a,s,o,n,false):B=this._atlas.getRasterizedGlyph(r,s,o,n,false),st=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),s!==h&&B.offset.x>st?(Pe=B.offset.x-st,e[D]=-(B.offset.x-Pe)+this._dimensions.device.char.left,e[D+1]=-B.offset.y+this._dimensions.device.char.top,e[D+2]=(B.size.x-Pe)/this._dimensions.device.canvas.width,e[D+3]=B.size.y/this._dimensions.device.canvas.height,e[D+4]=B.texturePage,e[D+5]=B.texturePositionClipSpace.x+Pe/this._atlas.pages[B.texturePage].canvas.width,e[D+6]=B.texturePositionClipSpace.y,e[D+7]=B.sizeClipSpace.x-Pe/this._atlas.pages[B.texturePage].canvas.width,e[D+8]=B.sizeClipSpace.y):(e[D]=-B.offset.x+this._dimensions.device.char.left,e[D+1]=-B.offset.y+this._dimensions.device.char.top,e[D+2]=B.size.x/this._dimensions.device.canvas.width,e[D+3]=B.size.y/this._dimensions.device.canvas.height,e[D+4]=B.texturePage,e[D+5]=B.texturePositionClipSpace.x,e[D+6]=B.texturePositionClipSpace.y,e[D+7]=B.sizeClipSpace.x,e[D+8]=B.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&Hi(r,c,B.size.x,this._dimensions.device.cell.width)&&(e[D+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let e=this._terminal,t=e.cols*e.rows*we;this._vertices.count!==t?this._vertices.attributes=new Float32Array(t):this._vertices.attributes.fill(0);let i=0;for(;i<this._vertices.attributesBuffers.length;i++)this._vertices.count!==t?this._vertices.attributesBuffers[i]=new Float32Array(t):this._vertices.attributesBuffers[i].fill(0);this._vertices.count=t,i=0;for(let r=0;r<e.rows;r++)for(let s=0;s<e.cols;s++)this._vertices.attributes[i+9]=s/e.cols,this._vertices.attributes[i+10]=r/e.rows,i+=we}handleResize(){let e=this._gl;e.useProgram(this._program),e.viewport(0,0,e.canvas.width,e.canvas.height),e.uniform2f(this._resolutionLocation,e.canvas.width,e.canvas.height),this.clear()}render(e){if(!this._atlas)return;let t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let i=this._vertices.attributesBuffers[this._activeBuffer],r=0;for(let s=0;s<e.lineLengths.length;s++){let o=s*this._terminal.cols*we,n=this._vertices.attributes.subarray(o,o+e.lineLengths[s]*we);i.set(n,r),r+=n.length}t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,i.subarray(0,r),t.STREAM_DRAW);for(let s=0;s<this._atlas.pages.length;s++)this._atlas.pages[s].version!==this._atlasTextures[s].version&&this._bindAtlasPageTexture(t,this._atlas,s);t.drawElementsInstanced(t.TRIANGLE_STRIP,4,t.UNSIGNED_BYTE,0,r/we)}setAtlas(e){this._atlas=e;for(let t of this._atlasTextures)t.version=-1}_bindAtlasPageTexture(e,t,i){e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,this._atlasTextures[i].texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.pages[i].canvas),e.generateMipmap(e.TEXTURE_2D),this._atlasTextures[i].version=t.pages[i].version}setDimensions(e){this._dimensions=e}};var Es=class{constructor(){this.clear()}clear(){this.hasSelection=false,this.columnSelectMode=false,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,r=false){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1]){this.clear();return}let s=e.buffers.active.ydisp,o=t[1]-s,n=i[1]-s,a=Math.max(o,0),c=Math.min(n,e.rows-1);if(a>=e.rows||c<0){this.clear();return}this.hasSelection=true,this.columnSelectMode=r,this.viewportStartRow=o,this.viewportEndRow=n,this.viewportCappedStartRow=a,this.viewportCappedEndRow=c,this.startCol=t[0],this.endCol=i[0]}isCellSelected(e,t,i){return this.hasSelection?(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol):false}};function ks(){return new Es}var Xe=4;var Ve=1;var je=2;var rt=3;var Fs=2147483648;var $s=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=ks()}resize(e,t){let i=e*t*Xe;i!==this.cells.length&&(this.cells=new Uint32Array(i),this.lineLengths=new Uint32Array(t))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}};var Ds=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`;var Ps=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`;var ve=8;var nt=ve*Float32Array.BYTES_PER_ELEMENT;var Is=20*ve;var $t=class{constructor(){this.attributes=new Float32Array(Is),this.count=0}};var _e=0;var Dt=0;var Pt=0;var It=0;var Wt=0;var Ot=0;var zt=0;var Ws=class extends ne{constructor(e,t,i,r){super();this._terminal=e;this._gl=t;this._dimensions=i;this._themeService=r;this._vertices=new $t;this._verticesCursor=new $t;let s=this._gl;this._program=W(wi(s,Ds,Ps)),this._register(j(()=>s.deleteProgram(this._program))),this._projectionLocation=W(s.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);let o=new Float32Array([0,0,1,0,0,1,1,1]),n=s.createBuffer();this._register(j(()=>s.deleteBuffer(n))),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,o,s.STATIC_DRAW),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,this._gl.FLOAT,false,0,0);let a=new Uint8Array([0,1,2,3]),c=s.createBuffer();this._register(j(()=>s.deleteBuffer(c))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a,s.STATIC_DRAW),this._attributesBuffer=W(s.createBuffer()),this._register(j(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,s.FLOAT,false,nt,0),s.vertexAttribDivisor(0,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,false,nt,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,4,s.FLOAT,false,nt,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(2,1),this._updateCachedColors(r.colors),this._register(this._themeService.onChangeColors(h=>{this._updateCachedColors(h),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(e){let t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),t.uniformMatrix4fv(this._projectionLocation,false,mi),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,e.attributes,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,t.UNSIGNED_BYTE,0,e.count)}handleResize(){this._updateViewportRectangle()}setDimensions(e){this._dimensions=e}_updateCachedColors(e){this._bgFloat=this._colorToFloat32Array(e.background),this._cursorFloat=this._colorToFloat32Array(e.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(e){let t=this._terminal,i=this._vertices,r=1,s,o,n,a,c,h,l,d,u,m,b;for(s=0;s<t.rows;s++){for(n=-1,a=0,c=0,h=false,o=0;o<t.cols;o++)l=(s*t.cols+o)*Xe,d=e.cells[l+Ve],u=e.cells[l+je],m=!!(u&67108864),(d!==a||u!==c&&(h||m))&&((a!==0||h&&c!==0)&&(b=r++*ve,this._updateRectangle(i,b,c,a,n,o,s)),n=o,a=d,c=u,h=m);(a!==0||h&&c!==0)&&(b=r++*ve,this._updateRectangle(i,b,c,a,n,t.cols,s))}i.count=r}updateCursor(e){let t=this._verticesCursor,i=e.cursor;if(!i||i.style==="block"){t.count=0;return}let r,s=0;(i.style==="bar"||i.style==="outline")&&(r=s++*ve,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,i.y*this._dimensions.device.cell.height,i.style==="bar"?i.dpr*i.cursorWidth:i.dpr,this._dimensions.device.cell.height,this._cursorFloat)),(i.style==="underline"||i.style==="outline")&&(r=s++*ve,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,(i.y+1)*this._dimensions.device.cell.height-i.dpr,i.width*this._dimensions.device.cell.width,i.dpr,this._cursorFloat)),i.style==="outline"&&(r=s++*ve,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,i.y*this._dimensions.device.cell.height,i.width*this._dimensions.device.cell.width,i.dpr,this._cursorFloat),r=s++*ve,this._addRectangleFloat(t.attributes,r,(i.x+i.width)*this._dimensions.device.cell.width-i.dpr,i.y*this._dimensions.device.cell.height,i.dpr,this._dimensions.device.cell.height,this._cursorFloat)),t.count=s}_updateRectangle(e,t,i,r,s,o,n){if(i&67108864)switch(i&50331648){case 16777216:case 33554432:_e=this._themeService.colors.ansi[i&255].rgba;break;case 50331648:_e=(i&16777215)<<8;break;case 0:default:_e=this._themeService.colors.foreground.rgba}else switch(r&50331648){case 16777216:case 33554432:_e=this._themeService.colors.ansi[r&255].rgba;break;case 50331648:_e=(r&16777215)<<8;break;case 0:default:_e=this._themeService.colors.background.rgba}e.attributes.length<t+4&&(e.attributes=Ms(e.attributes,this._terminal.rows*this._terminal.cols*ve)),Dt=s*this._dimensions.device.cell.width,Pt=n*this._dimensions.device.cell.height,It=(_e>>24&255)/255,Wt=(_e>>16&255)/255,Ot=(_e>>8&255)/255,zt=1,this._addRectangle(e.attributes,t,Dt,Pt,(o-s)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,It,Wt,Ot,zt)}_addRectangle(e,t,i,r,s,o,n,a,c,h){e[t]=i/this._dimensions.device.canvas.width,e[t+1]=r/this._dimensions.device.canvas.height,e[t+2]=s/this._dimensions.device.canvas.width,e[t+3]=o/this._dimensions.device.canvas.height,e[t+4]=n,e[t+5]=a,e[t+6]=c,e[t+7]=h}_addRectangleFloat(e,t,i,r,s,o,n){e[t]=i/this._dimensions.device.canvas.width,e[t+1]=r/this._dimensions.device.canvas.height,e[t+2]=s/this._dimensions.device.canvas.width,e[t+3]=o/this._dimensions.device.canvas.height,e[t+4]=n[0],e[t+5]=n[1],e[t+6]=n[2],e[t+7]=n[3]}_colorToFloat32Array(e){return new Float32Array([(e.rgba>>24&255)/255,(e.rgba>>16&255)/255,(e.rgba>>8&255)/255,(e.rgba&255)/255])}};var Os=class extends ne{constructor(e,t,i,r,s,o,n,a){super();this._container=t;this._alpha=s;this._coreBrowserService=o;this._optionsService=n;this._themeService=a;this._deviceCharWidth=0;this._deviceCharHeight=0;this._deviceCellWidth=0;this._deviceCellHeight=0;this._deviceCharLeft=0;this._deviceCharTop=0;this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${i}-layer`),this._canvas.style.zIndex=r.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors(c=>{this._refreshCharAtlas(e,c),this.reset(e)})),this._register(j(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=W(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(e){}handleFocus(e){}handleCursorMove(e){}handleGridChanged(e,t,i){}handleSelectionChanged(e,t,i,r=false){}_setTransparency(e,t){if(t===this._alpha)return;let i=this._canvas;this._alpha=t,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,i),this._refreshCharAtlas(e,this._themeService.colors),this.handleGridChanged(e,0,e.rows-1)}_refreshCharAtlas(e,t){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=fi(e,this._optionsService.rawOptions,t,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlas.warmUp())}resize(e,t){this._deviceCellWidth=t.device.cell.width,this._deviceCellHeight=t.device.cell.height,this._deviceCharWidth=t.device.char.width,this._deviceCharHeight=t.device.char.height,this._deviceCharLeft=t.device.char.left,this._deviceCharTop=t.device.char.top,this._canvas.width=t.device.canvas.width,this._canvas.height=t.device.canvas.height,this._canvas.style.width=`${t.css.canvas.width}px`,this._canvas.style.height=`${t.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(e,this._themeService.colors)}_fillBottomLineAtCells(e,t,i=1){this._ctx.fillRect(e*this._deviceCellWidth,(t+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,i*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(e,t,i,r){this._alpha?this._ctx.clearRect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,r*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,r*this._deviceCellHeight))}_fillCharTrueColor(e,t,i,r){this._ctx.font=this._getFont(e,false,false),this._ctx.textBaseline=ri,this._clipCell(i,r,t.getWidth()),this._ctx.fillText(t.getChars(),i*this._deviceCellWidth+this._deviceCharLeft,r*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(e,t,i){this._ctx.beginPath(),this._ctx.rect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(e,t,i){let r=t?e.options.fontWeightBold:e.options.fontWeight;return`${i?"italic":""} ${r} ${e.options.fontSize*this._coreBrowserService.dpr}px ${e.options.fontFamily}`}};var zs=class extends Os{constructor(e,t,i,r,s,o,n){super(i,e,"link",t,true,s,o,n),this._register(r.onShowLinkUnderline(a=>this._handleShowLinkUnderline(a))),this._register(r.onHideLinkUnderline(a=>this._handleHideLinkUnderline(a)))}resize(e,t){super.resize(e,t),this._state=void 0}reset(e){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let e=this._state.y2-this._state.y1-1;e>0&&this._clearCells(0,this._state.y1+1,this._state.cols,e),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(e){if(e.fg===Xi?this._ctx.fillStyle=this._themeService.colors.background.css:e.fg!==void 0&&Ls(e.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[e.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,e.y1===e.y2)this._fillBottomLineAtCells(e.x1,e.y1,e.x2-e.x1);else{this._fillBottomLineAtCells(e.x1,e.y1,e.cols-e.x1);for(let t=e.y1+1;t<e.y2;t++)this._fillBottomLineAtCells(0,t,e.cols);this._fillBottomLineAtCells(0,e.y2,e.x2)}this._state=e}_handleHideLinkUnderline(e){this._clearCurrentLink()}};var Le=typeof window=="object"?window:globalThis;var gt=class hr{constructor(){this.mapWindowIdToZoomLevel=new Map;this._onDidChangeZoomLevel=new E;this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event;this.mapWindowIdToZoomFactor=new Map;this._onDidChangeFullscreen=new E;this.onDidChangeFullscreen=this._onDidChangeFullscreen.event;this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,i){if(this.getZoomLevel(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(r,t),this._onDidChangeZoomLevel.fire(r)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),t)}setFullscreen(t,i){if(this.isFullscreen(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToFullScreen.set(r,t),this._onDidChangeFullscreen.fire(r)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};gt.INSTANCE=new gt;var Ci=gt;function Us(e,t,i){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",i)}Ci.INSTANCE.onDidChangeZoomLevel;Ci.INSTANCE.onDidChangeFullscreen;var ke=typeof navigator=="object"?navigator.userAgent:"";ke.indexOf("Firefox")>=0;ke.indexOf("AppleWebKit")>=0;var Ns=ke.indexOf("Chrome")>=0;!Ns&&ke.indexOf("Safari")>=0;ke.indexOf("Electron/")>=0;ke.indexOf("Android")>=0;var ot=false;if(typeof Le.matchMedia=="function"){let e=Le.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=Le.matchMedia("(display-mode: fullscreen)");ot=e.matches,Us(Le,e,({matches:i})=>{ot&&t.matches||(ot=i)})}var Be="en";var at=false;var xi=false;var Ge;var Ye=Be;var Ut=Be;var qs;var ge;var ye=globalThis;var J;typeof ye.vscode<"u"&&typeof ye.vscode.process<"u"?J=ye.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(J=process);var Gs=typeof J?.versions?.electron=="string";var Hs=Gs&&J?.type==="renderer";if(typeof J=="object"){J.platform==="win32",J.platform==="darwin",at=J.platform==="linux",at&&!!J.env.SNAP&&!!J.env.SNAP_REVISION,!!J.env.CI||!!J.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Ge=Be,Ye=Be;let e=J.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);Ge=t.userLocale,Ut=t.osLocale,Ye=t.resolvedLanguage||Be,qs=t.languagePack?.translationsConfigFile}catch{}xi=true}else typeof navigator=="object"&&!Hs?(ge=navigator.userAgent,ge.indexOf("Windows")>=0,ge.indexOf("Macintosh")>=0,(ge.indexOf("Macintosh")>=0||ge.indexOf("iPad")>=0||ge.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,at=ge.indexOf("Linux")>=0,ge?.indexOf("Mobi")>=0,Ye=globalThis._VSCODE_NLS_LANGUAGE||Be,Ge=navigator.language.toLowerCase(),Ut=Ge):console.error("Unable to resolve platform.");var Nt=xi;var ae=ge;var pe=Ye;var Vs;(e=>{function t(){return pe}e.value=t;function i(){return pe.length===2?pe==="en":pe.length>=3?pe[0]==="e"&&pe[1]==="n"&&pe[2]==="-":false}e.isDefaultVariant=i;function r(){return pe==="en"}e.isDefault=r})(Vs||={});var js=typeof ye.postMessage=="function"&&!ye.importScripts;(()=>{if(js){let e=[];ye.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let o=e[r];if(o.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),o.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),ye.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})();var Ys=!!(ae&&ae.indexOf("Chrome")>=0);!!(ae&&ae.indexOf("Firefox")>=0);!!(!Ys&&ae&&ae.indexOf("Safari")>=0);!!(ae&&ae.indexOf("Edg/")>=0);!!(ae&&ae.indexOf("Android")>=0);var Ae=typeof navigator=="object"?navigator:{};({clipboard:{writeText:Nt||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(Ae&&Ae.clipboard&&Ae.clipboard.writeText),readText:Nt||!!(Ae&&Ae.clipboard&&Ae.clipboard.readText)}});var mt=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}};var ht=new mt;var qt=new mt;var Gt=new mt;new Array(230);var Xs;(e=>{function t(a){return ht.keyCodeToStr(a)}e.toString=t;function i(a){return ht.strToKeyCode(a)}e.fromString=i;function r(a){return qt.keyCodeToStr(a)}e.toUserSettingsUS=r;function s(a){return Gt.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function o(a){return qt.strToKeyCode(a)||Gt.strToKeyCode(a)}e.fromUserSettings=o;function n(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return ht.keyCodeToStr(a)}e.toElectronAccelerator=n})(Xs||={});var Li=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}});var Qs;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof Zs?true:!i||typeof i!="object"?false:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:false,onCancellationRequested:fe.None}),e.Cancelled=Object.freeze({isCancellationRequested:true,onCancellationRequested:Li})})(Qs||={});var Zs=class{constructor(){this._isCancelled=false;this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=true,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Li:(this._emitter||(this._emitter=new E),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}};var Ks;(e=>{async function t(r){let s,o=await Promise.all(r.map(n=>n.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return o}e.settled=t;function i(r){return new Promise(async(s,o)=>{try{await r(s,o)}catch(n){o(n)}})}e.withAsyncBody=i})(Ks||={});var Ht=class ie{static fromArray(t){return new ie(i=>{i.emitMany(t)})}static fromPromise(t){return new ie(async i=>{i.emitMany(await t)})}static fromPromises(t){return new ie(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new ie(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new E,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:false,value:this._results[t++]};if(this._state===1)return{done:true,value:void 0};await fe.toPromise(this._onStateChanged.event)}while(true)},return:async()=>(this._onReturn?.(),{done:true,value:void 0})}}static map(t,i){return new ie(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return ie.map(this,t)}static filter(t,i){return new ie(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return ie.filter(this,t)}static coalesce(t){return ie.filter(t,i=>!!i)}coalesce(){return ie.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return ie.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};Ht.EMPTY=Ht.fromArray([]);var{getWindow:Js}=function(){let e=new Map;let t={window:Le,disposables:new Ee};e.set(Le.vscodeWindowId,t);let i=new E,r=new E,s=new E;function o(n,a){return(typeof n=="number"?e.get(n):void 0)??(a?t:void 0)}return{onDidRegisterWindow:i.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:r.event,registerWindow(n){if(e.has(n.vscodeWindowId))return ne.None;let a=new Ee,c={window:n,disposables:a.add(new Ee)};return e.set(n.vscodeWindowId,c),a.add(j(()=>{e.delete(n.vscodeWindowId),r.fire(n)})),a.add(vt(n,tr.BEFORE_UNLOAD,()=>{s.fire(n)})),i.fire(c),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(n){return n.vscodeWindowId},hasWindow(n){return e.has(n)},getWindowById:o,getWindow(n){let a=n;if(a?.ownerDocument?.defaultView)return a.ownerDocument.defaultView.window;let c=n;return c?.view?c.view.window:Le},getDocument(n){return Js(n).document}}}();var er=class{constructor(e,t,i,r){this._node=e,this._type=t,this._handler=i,this._options=r||false,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function vt(e,t,i,r){return new er(e,t,i,r)}var tr={BEFORE_UNLOAD:"beforeunload"};var ir=class extends ne{constructor(e,t,i,r,s,o,n,a,c){super();this._terminal=e;this._characterJoinerService=t;this._charSizeService=i;this._coreBrowserService=r;this._coreService=s;this._decorationService=o;this._optionsService=n;this._themeService=a;this._cursorBlinkStateManager=new Fe;this._charAtlasDisposable=this._register(new Fe);this._observerDisposable=this._register(new Fe);this._model=new $s;this._workCell=new kt;this._workCell2=new kt;this._rectangleRenderer=this._register(new Fe);this._glyphRenderer=this._register(new Fe);this._onChangeTextureAtlas=this._register(new E);this.onChangeTextureAtlas=this._onChangeTextureAtlas.event;this._onAddTextureAtlasCanvas=this._register(new E);this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;this._onRemoveTextureAtlasCanvas=this._register(new E);this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event;this._onRequestRedraw=this._register(new E);this.onRequestRedraw=this._onRequestRedraw.event;this._onContextLoss=this._register(new E);this.onContextLoss=this._onContextLoss.event;this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new Yi(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new zs(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,n,this._themeService)],this.dimensions=Vi(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(n.onOptionChange(()=>this._handleOptionsChanged())),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let h={antialias:false,depth:false,preserveDrawingBuffer:c};if(this._gl=this._canvas.getContext("webgl2",h),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this._register(vt(this._canvas,"webglcontextlost",l=>{console.log("webglcontextlost event received"),l.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(l)},3e3)})),this._register(vt(this._canvas,"webglcontextrestored",l=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,Bt(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=Et(this._canvas,this._coreBrowserService.window,(l,d)=>this._setCanvasDevicePixelDimensions(l,d)),this._register(this._coreBrowserService.onWindowChange(l=>{this._observerDisposable.value=Et(this._canvas,l,(d,u)=>this._setCanvasDevicePixelDimensions(d,u))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._coreBrowserService.window.document.body.contains(this._core.screenElement),this._register(j(()=>{for(let l of this._renderLayers)l.dispose();this._canvas.parentElement?.removeChild(this._canvas),Bt(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(true)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(e,t){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let i of this._renderLayers)i.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(false)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let e of this._renderLayers)e.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let e of this._renderLayers)e.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(e,t,i){for(let r of this._renderLayers)r.handleSelectionChanged(this._terminal,e,t,i);this._model.selection.update(this._core,e,t,i),this._requestRedrawViewport()}handleCursorMove(){for(let e of this._renderLayers)e.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new Ws(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new Bs(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=false;return}let e=fi(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr);this._charAtlas!==e&&(this._onChangeTextureAtlas.fire(e.pages[0].canvas),this._charAtlasDisposable.value=Jt(fe.forward(e.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),fe.forward(e.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=e,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(e){this._model.clear(),e&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(true),this._requestRedrawViewport()}clear(){this._clearModel(true);for(let e of this._renderLayers)e.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows(e,t){if(!this._isAttached)if(this._coreBrowserService.window.document.body.contains(this._core.screenElement)&&this._charSizeService.width&&this._charSizeService.height)this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=true;else return;for(let i of this._renderLayers)i.handleGridChanged(this._terminal,e,t);!this._glyphRenderer.value||!this._rectangleRenderer.value||(this._glyphRenderer.value.beginFrame()?(this._clearModel(true),this._updateModel(0,this._terminal.rows-1)):this._updateModel(e,t),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new bs(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(e,t){let i=this._core,r=this._workCell,s,o,n,a,c,h,l,d,u,m,b,S,y,F;e=Vt(e,i.rows-1,0),t=Vt(t,i.rows-1,0);let I=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,z=I-i.buffer.ydisp,L=Math.min(this._terminal.buffer.active.cursorX,i.cols-1),A=-1,R=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let O=false;for(o=e;o<=t;o++)for(n=o+i.buffer.ydisp,a=i.buffer.lines.get(n),this._model.lineLengths[o]=0,c=this._characterJoinerService.getJoinedCharacters(n),y=0;y<i.cols;y++)if(s=this._cellColorResolver.result.bg,a.loadCell(y,r),y===0&&(s=this._cellColorResolver.result.bg),h=false,l=y,c.length>0&&y===c[0][0]&&(h=true,d=c.shift(),r=new sr(r,a.translateToString(true,d[0],d[1]),d[1]-d[0]),l=d[1]-1),u=r.getChars(),m=r.getCode(),S=(o*i.cols+y)*Xe,this._cellColorResolver.resolve(r,y,n,this.dimensions.device.cell.width),R&&n===I&&(y===L&&(this._model.cursor={x:L,y:z,width:r.getWidth(),style:this._coreBrowserService.isFocused?i.options.cursorStyle||"block":i.options.cursorInactiveStyle,cursorWidth:i.options.cursorWidth,dpr:this._devicePixelRatio},A=L+r.getWidth()-1),y>=L&&y<=A&&(this._coreBrowserService.isFocused&&(i.options.cursorStyle||"block")==="block"||this._coreBrowserService.isFocused===false&&i.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),m!==0&&(this._model.lineLengths[o]=y+1),!(this._model.cells[S]===m&&this._model.cells[S+Ve]===this._cellColorResolver.result.bg&&this._model.cells[S+je]===this._cellColorResolver.result.fg&&this._model.cells[S+rt]===this._cellColorResolver.result.ext)&&(O=true,u.length>1&&(m|=Fs),this._model.cells[S]=m,this._model.cells[S+Ve]=this._cellColorResolver.result.bg,this._model.cells[S+je]=this._cellColorResolver.result.fg,this._model.cells[S+rt]=this._cellColorResolver.result.ext,b=r.getWidth(),this._glyphRenderer.value.updateCell(y,o,m,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,u,b,s),h)){for(r=this._workCell,y++;y<=l;y++)F=(o*i.cols+y)*Xe,this._glyphRenderer.value.updateCell(y,o,0,0,0,0,Oi,0,0),this._model.cells[F]=0,this._model.cells[F+Ve]=this._cellColorResolver.result.bg,this._model.cells[F+je]=this._cellColorResolver.result.fg,this._model.cells[F+rt]=this._cellColorResolver.result.ext;y--}O&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){!this._charSizeService.width||!this._charSizeService.height||(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(e,t){this._canvas.width===e&&this._canvas.height===t||(this._canvas.width=e,this._canvas.height=t,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let e=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:e,end:e})}};var sr=class extends Te{constructor(e,t,i){super();this.content=0;this.combinedData="";this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function Vt(e,t,i=0){return Math.max(Math.min(e,t),i)}var jt="di$target";var Yt="di$dependencies";var lt=new Map;function he(e){if(lt.has(e))return lt.get(e);let t=function(i,r,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");rr(t,i,s)};return t.toString=()=>e,lt.set(e,t),t}function rr(e,t,i){t[jt]===t?t[Yt].push({id:e,index:i}):(t[Yt]=[{id:e,index:i}],t[jt]=t)}he("BufferService");he("CoreMouseService");he("CoreService");he("CharsetService");he("InstantiationService");he("LogService");var nr=he("OptionsService");he("OscLinkService");he("UnicodeService");he("DecorationService");var or={trace:0,debug:1,info:2,warn:3,error:4,off:5};var ar="xterm.js: ";var Xt=class extends ne{constructor(e){super();this._optionsService=e;this._logLevel=5;this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=or[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":ar)+t,...i)}trace(e,...t){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};Xt=Si([Ai(0,nr)],Xt);var lr=class extends ne{constructor(e){if(ii&&Wi()<16){let t={antialias:false,depth:false,preserveDrawingBuffer:true};if(!document.createElement("canvas").getContext("webgl2",t))throw new Error("Webgl2 is only supported on Safari 16 and above")}super();this._preserveDrawingBuffer=e;this._onChangeTextureAtlas=this._register(new E);this.onChangeTextureAtlas=this._onChangeTextureAtlas.event;this._onAddTextureAtlasCanvas=this._register(new E);this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;this._onRemoveTextureAtlasCanvas=this._register(new E);this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event;this._onContextLoss=this._register(new E);this.onContextLoss=this._onContextLoss.event}activate(e){let t=e._core;if(!e.element){this._register(t.onWillOpen(()=>this.activate(e)));return}this._terminal=e;let i=t.coreService,r=t.optionsService,s=t,o=s._renderService,n=s._characterJoinerService,a=s._charSizeService,c=s._coreBrowserService,h=s._decorationService;s._logService;let l=s._themeService;this._renderer=this._register(new ir(e,n,a,c,i,h,r,l,this._preserveDrawingBuffer)),this._register(fe.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(fe.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(fe.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(fe.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),o.setRenderer(this._renderer),this._register(j(()=>{if(this._terminal._core._store._isDisposed)return;let d=this._terminal._core._renderService;d.setRenderer(this._terminal._core._createRenderer()),d.handleResize(e.cols,e.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}};export{lr as WebglAddon};
